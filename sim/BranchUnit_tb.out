#! /c/Source/iverilog-install/bin/vvp
:ivl_version "12.0 (devel)" "(s20150603-1539-g2693dd32b)";
:ivl_delay_selection "TYPICAL";
:vpi_time_precision - 12;
:vpi_module "C:\iverilog\lib\ivl\system.vpi";
:vpi_module "C:\iverilog\lib\ivl\vhdl_sys.vpi";
:vpi_module "C:\iverilog\lib\ivl\vhdl_textio.vpi";
:vpi_module "C:\iverilog\lib\ivl\v2005_math.vpi";
:vpi_module "C:\iverilog\lib\ivl\va_math.vpi";
:vpi_module "C:\iverilog\lib\ivl\v2009.vpi";
S_0000019d2050bb20 .scope package, "$unit" "$unit" 2 1;
 .timescale 0 0;
S_0000019d2090b180 .scope module, "BranchUnit_tb" "BranchUnit_tb" 3 3;
 .timescale -9 -12;
v0000019d208e2ed0_0 .var/s "A", 31 0;
v0000019d208e2f70_0 .var/s "B", 31 0;
v0000019d208e3010_0 .var "BrOp", 4 0;
v0000019d208e30b0_0 .net "NextPCSrc", 0 0, v0000019d20509930_0;  1 drivers
v0000019d208e3150_0 .var/i "errors", 31 0;
v0000019d20912e30_0 .var "expected", 0 0;
v0000019d20912ed0_0 .var/i "tests", 31 0;
S_0000019d20912070 .scope task, "check_result" "check_result" 3 31, 3 31 0, S_0000019d2090b180;
 .timescale -9 -12;
v0000019d2050c560_0 .var "exp", 0 0;
v0000019d20912200_0 .var/str "test_name";
TD_BranchUnit_tb.check_result ;
    ; show_stmt_assign_vector: Get l-value for compressed += operand
    %load/vec4 v0000019d20912ed0_0;
    %pushi/vec4 1, 0, 32;
    %add;
    %store/vec4 v0000019d20912ed0_0, 0, 32;
    %delay 1000, 0;
    %load/vec4 v0000019d208e30b0_0;
    %load/vec4 v0000019d2050c560_0;
    %cmp/ne;
    %jmp/0xz  T_0.0, 6;
    %vpi_call/w 3 35 "$display", "ERROR: %s", v0000019d20912200_0 {0 0 0};
    %vpi_call/w 3 36 "$display", "   BrOp:     0x%h (%05b)", v0000019d208e3010_0, v0000019d208e3010_0 {0 0 0};
    %vpi_call/w 3 37 "$display", "   A:        0x%h (%0d)", v0000019d208e2ed0_0, v0000019d208e2ed0_0 {0 0 0};
    %vpi_call/w 3 38 "$display", "   B:        0x%h (%0d)", v0000019d208e2f70_0, v0000019d208e2f70_0 {0 0 0};
    %vpi_call/w 3 39 "$display", "   Expected: %0b", v0000019d2050c560_0 {0 0 0};
    %vpi_call/w 3 40 "$display", "   Got:      %0b", v0000019d208e30b0_0 {0 0 0};
    ; show_stmt_assign_vector: Get l-value for compressed += operand
    %load/vec4 v0000019d208e3150_0;
    %pushi/vec4 1, 0, 32;
    %add;
    %store/vec4 v0000019d208e3150_0, 0, 32;
    %jmp T_0.1;
T_0.0 ;
    %vpi_call/w 3 43 "$display", "PASS: %s", v0000019d20912200_0 {0 0 0};
    %vpi_call/w 3 44 "$display", "   BrOp: %05b, A = %0d, B = %0d, NextPCSrc = %0b", v0000019d208e3010_0, v0000019d208e2ed0_0, v0000019d208e2f70_0, v0000019d208e30b0_0 {0 0 0};
T_0.1 ;
    %vpi_call/w 3 46 "$display", "\000" {0 0 0};
    %end;
S_0000019d208e2d40 .scope module, "uut" "BranchUnit" 3 12, 4 1 0, S_0000019d2090b180;
 .timescale -9 -12;
    .port_info 0 /INPUT 5 "BrOp";
    .port_info 1 /INPUT 32 "A";
    .port_info 2 /INPUT 32 "B";
    .port_info 3 /OUTPUT 1 "NextPCSrc";
v0000019d2090f460_0 .net/s "A", 31 0, v0000019d208e2ed0_0;  1 drivers
v0000019d2090e740_0 .net/s "B", 31 0, v0000019d208e2f70_0;  1 drivers
v0000019d20509890_0 .net "BrOp", 4 0, v0000019d208e3010_0;  1 drivers
v0000019d20509930_0 .var "NextPCSrc", 0 0;
E_0000019d2090fd80 .event anyedge, v0000019d20509890_0, v0000019d2090f460_0, v0000019d2090e740_0;
    .scope S_0000019d208e2d40;
T_1 ;
    %wait E_0000019d2090fd80;
    %load/vec4 v0000019d20509890_0;
    %dup/vec4;
    %pushi/vec4 7, 7, 5;
    %cmp/x;
    %jmp/1 T_1.0, 4;
    %dup/vec4;
    %pushi/vec4 8, 0, 5;
    %cmp/x;
    %jmp/1 T_1.1, 4;
    %dup/vec4;
    %pushi/vec4 9, 0, 5;
    %cmp/x;
    %jmp/1 T_1.2, 4;
    %dup/vec4;
    %pushi/vec4 12, 0, 5;
    %cmp/x;
    %jmp/1 T_1.3, 4;
    %dup/vec4;
    %pushi/vec4 13, 0, 5;
    %cmp/x;
    %jmp/1 T_1.4, 4;
    %dup/vec4;
    %pushi/vec4 14, 0, 5;
    %cmp/x;
    %jmp/1 T_1.5, 4;
    %dup/vec4;
    %pushi/vec4 15, 0, 5;
    %cmp/x;
    %jmp/1 T_1.6, 4;
    %dup/vec4;
    %pushi/vec4 31, 15, 5;
    %cmp/x;
    %jmp/1 T_1.7, 4;
    %pushi/vec4 0, 0, 1;
    %store/vec4 v0000019d20509930_0, 0, 1;
    %jmp T_1.9;
T_1.0 ;
    %pushi/vec4 0, 0, 1;
    %store/vec4 v0000019d20509930_0, 0, 1;
    %jmp T_1.9;
T_1.1 ;
    %load/vec4 v0000019d2090f460_0;
    %load/vec4 v0000019d2090e740_0;
    %cmp/e;
    %flag_get/vec4 4;
    %store/vec4 v0000019d20509930_0, 0, 1;
    %jmp T_1.9;
T_1.2 ;
    %load/vec4 v0000019d2090f460_0;
    %load/vec4 v0000019d2090e740_0;
    %cmp/ne;
    %flag_get/vec4 4;
    %store/vec4 v0000019d20509930_0, 0, 1;
    %jmp T_1.9;
T_1.3 ;
    %load/vec4 v0000019d2090f460_0;
    %load/vec4 v0000019d2090e740_0;
    %cmp/s;
    %flag_get/vec4 5;
    %store/vec4 v0000019d20509930_0, 0, 1;
    %jmp T_1.9;
T_1.4 ;
    %load/vec4 v0000019d2090e740_0;
    %load/vec4 v0000019d2090f460_0;
    %cmp/s;
    %flag_get/vec4 4;
    %flag_get/vec4 5;
    %or;
    %store/vec4 v0000019d20509930_0, 0, 1;
    %jmp T_1.9;
T_1.5 ;
    %load/vec4 v0000019d2090f460_0;
    %load/vec4 v0000019d2090e740_0;
    %cmp/u;
    %flag_get/vec4 5;
    %store/vec4 v0000019d20509930_0, 0, 1;
    %jmp T_1.9;
T_1.6 ;
    %load/vec4 v0000019d2090e740_0;
    %load/vec4 v0000019d2090f460_0;
    %cmp/u;
    %flag_get/vec4 4;
    %flag_get/vec4 5;
    %or;
    %store/vec4 v0000019d20509930_0, 0, 1;
    %jmp T_1.9;
T_1.7 ;
    %pushi/vec4 1, 0, 1;
    %store/vec4 v0000019d20509930_0, 0, 1;
    %jmp T_1.9;
T_1.9 ;
    %pop/vec4 1;
    %jmp T_1;
    .thread T_1, $push;
    .scope S_0000019d2090b180;
T_2 ;
    %pushi/vec4 0, 0, 32;
    %store/vec4 v0000019d208e3150_0, 0, 32;
    %pushi/vec4 0, 0, 32;
    %store/vec4 v0000019d20912ed0_0, 0, 32;
    %end;
    .thread T_2, $init;
    .scope S_0000019d2090b180;
T_3 ;
    %vpi_call/w 3 26 "$dumpfile", "sim/BranchUnit_tb.vcd" {0 0 0};
    %vpi_call/w 3 27 "$dumpvars", 32'sb00000000000000000000000000000000, S_0000019d2090b180 {0 0 0};
    %end;
    .thread T_3;
    .scope S_0000019d2090b180;
T_4 ;
    %vpi_call/w 3 50 "$display", "\012========================================" {0 0 0};
    %vpi_call/w 3 51 "$display", "  BranchUnit Testbench" {0 0 0};
    %vpi_call/w 3 52 "$display", "========================================\012" {0 0 0};
    %pushi/vec4 0, 0, 5;
    %store/vec4 v0000019d208e3010_0, 0, 5;
    %pushi/vec4 10, 0, 32;
    %store/vec4 v0000019d208e2ed0_0, 0, 32;
    %pushi/vec4 10, 0, 32;
    %store/vec4 v0000019d208e2f70_0, 0, 32;
    %pushi/vec4 0, 0, 1;
    %store/vec4 v0000019d20912e30_0, 0, 1;
    %delay 10000, 0;
    %pushi/str "Test 1: NO BRANCH";
    %store/str v0000019d20912200_0;
    %load/vec4 v0000019d20912e30_0;
    %store/vec4 v0000019d2050c560_0, 0, 1;
    %fork TD_BranchUnit_tb.check_result, S_0000019d20912070;
    %join;
    %pushi/vec4 8, 0, 5;
    %store/vec4 v0000019d208e3010_0, 0, 5;
    %pushi/vec4 15, 0, 32;
    %store/vec4 v0000019d208e2ed0_0, 0, 32;
    %pushi/vec4 15, 0, 32;
    %store/vec4 v0000019d208e2f70_0, 0, 32;
    %pushi/vec4 1, 0, 1;
    %store/vec4 v0000019d20912e30_0, 0, 1;
    %delay 10000, 0;
    %pushi/str "Test 2: BEQ - Equal values (should branch)";
    %store/str v0000019d20912200_0;
    %load/vec4 v0000019d20912e30_0;
    %store/vec4 v0000019d2050c560_0, 0, 1;
    %fork TD_BranchUnit_tb.check_result, S_0000019d20912070;
    %join;
    %pushi/vec4 9, 0, 5;
    %store/vec4 v0000019d208e3010_0, 0, 5;
    %pushi/vec4 20, 0, 32;
    %store/vec4 v0000019d208e2ed0_0, 0, 32;
    %pushi/vec4 25, 0, 32;
    %store/vec4 v0000019d208e2f70_0, 0, 32;
    %pushi/vec4 1, 0, 1;
    %store/vec4 v0000019d20912e30_0, 0, 1;
    %delay 10000, 0;
    %pushi/str "Test 3: BNE - Different values (should branch)";
    %store/str v0000019d20912200_0;
    %load/vec4 v0000019d20912e30_0;
    %store/vec4 v0000019d2050c560_0, 0, 1;
    %fork TD_BranchUnit_tb.check_result, S_0000019d20912070;
    %join;
    %pushi/vec4 12, 0, 5;
    %store/vec4 v0000019d208e3010_0, 0, 5;
    %pushi/vec4 4294967286, 0, 32;
    %store/vec4 v0000019d208e2ed0_0, 0, 32;
    %pushi/vec4 5, 0, 32;
    %store/vec4 v0000019d208e2f70_0, 0, 32;
    %pushi/vec4 1, 0, 1;
    %store/vec4 v0000019d20912e30_0, 0, 1;
    %delay 10000, 0;
    %pushi/str "Test 4: BLT - Negative < Positive (should branch)";
    %store/str v0000019d20912200_0;
    %load/vec4 v0000019d20912e30_0;
    %store/vec4 v0000019d2050c560_0, 0, 1;
    %fork TD_BranchUnit_tb.check_result, S_0000019d20912070;
    %join;
    %pushi/vec4 13, 0, 5;
    %store/vec4 v0000019d208e3010_0, 0, 5;
    %pushi/vec4 30, 0, 32;
    %store/vec4 v0000019d208e2ed0_0, 0, 32;
    %pushi/vec4 30, 0, 32;
    %store/vec4 v0000019d208e2f70_0, 0, 32;
    %pushi/vec4 1, 0, 1;
    %store/vec4 v0000019d20912e30_0, 0, 1;
    %delay 10000, 0;
    %pushi/str "Test 5: BGE - Equal values (should branch)";
    %store/str v0000019d20912200_0;
    %load/vec4 v0000019d20912e30_0;
    %store/vec4 v0000019d2050c560_0, 0, 1;
    %fork TD_BranchUnit_tb.check_result, S_0000019d20912070;
    %join;
    %pushi/vec4 14, 0, 5;
    %store/vec4 v0000019d208e3010_0, 0, 5;
    %pushi/vec4 4294967295, 0, 32;
    %store/vec4 v0000019d208e2ed0_0, 0, 32;
    %pushi/vec4 100, 0, 32;
    %store/vec4 v0000019d208e2f70_0, 0, 32;
    %pushi/vec4 0, 0, 1;
    %store/vec4 v0000019d20912e30_0, 0, 1;
    %delay 10000, 0;
    %pushi/str "Test 6: BLTU - Unsigned comparison (should NOT branch)";
    %store/str v0000019d20912200_0;
    %load/vec4 v0000019d20912e30_0;
    %store/vec4 v0000019d2050c560_0, 0, 1;
    %fork TD_BranchUnit_tb.check_result, S_0000019d20912070;
    %join;
    %pushi/vec4 15, 0, 5;
    %store/vec4 v0000019d208e3010_0, 0, 5;
    %pushi/vec4 50, 0, 32;
    %store/vec4 v0000019d208e2ed0_0, 0, 32;
    %pushi/vec4 25, 0, 32;
    %store/vec4 v0000019d208e2f70_0, 0, 32;
    %pushi/vec4 1, 0, 1;
    %store/vec4 v0000019d20912e30_0, 0, 1;
    %delay 10000, 0;
    %pushi/str "Test 7: BGEU - A >= B unsigned (should branch)";
    %store/str v0000019d20912200_0;
    %load/vec4 v0000019d20912e30_0;
    %store/vec4 v0000019d2050c560_0, 0, 1;
    %fork TD_BranchUnit_tb.check_result, S_0000019d20912070;
    %join;
    %pushi/vec4 16, 0, 5;
    %store/vec4 v0000019d208e3010_0, 0, 5;
    %pushi/vec4 0, 0, 32;
    %store/vec4 v0000019d208e2ed0_0, 0, 32;
    %pushi/vec4 0, 0, 32;
    %store/vec4 v0000019d208e2f70_0, 0, 32;
    %pushi/vec4 1, 0, 1;
    %store/vec4 v0000019d20912e30_0, 0, 1;
    %delay 10000, 0;
    %pushi/str "Test 8: JAL/JALR - Unconditional jump (should branch)";
    %store/str v0000019d20912200_0;
    %load/vec4 v0000019d20912e30_0;
    %store/vec4 v0000019d2050c560_0, 0, 1;
    %fork TD_BranchUnit_tb.check_result, S_0000019d20912070;
    %join;
    %vpi_call/w 3 111 "$display", "========================================" {0 0 0};
    %vpi_call/w 3 112 "$display", "  TEST SUMMARY" {0 0 0};
    %vpi_call/w 3 113 "$display", "========================================" {0 0 0};
    %vpi_call/w 3 114 "$display", "Total tests: %0d", v0000019d20912ed0_0 {0 0 0};
    %load/vec4 v0000019d20912ed0_0;
    %load/vec4 v0000019d208e3150_0;
    %sub;
    %vpi_call/w 3 115 "$display", "Passed:      %0d", S<0,vec4,s32> {1 0 0};
    %vpi_call/w 3 116 "$display", "Failed:      %0d", v0000019d208e3150_0 {0 0 0};
    %load/vec4 v0000019d208e3150_0;
    %cmpi/e 0, 0, 32;
    %jmp/0xz  T_4.0, 4;
    %vpi_call/w 3 119 "$display", "\012ALL TESTS PASSED" {0 0 0};
    %jmp T_4.1;
T_4.0 ;
    %vpi_call/w 3 121 "$display", "\012SOME TESTS FAILED" {0 0 0};
T_4.1 ;
    %vpi_call/w 3 123 "$display", "========================================\012" {0 0 0};
    %vpi_call/w 3 125 "$finish" {0 0 0};
    %end;
    .thread T_4;
# The file index is used to find the file name in the following table.
:file_names 5;
    "N/A";
    "<interactive>";
    "-";
    "tb/BranchUnit_tb.sv";
    "src/BranchUnit.sv";
